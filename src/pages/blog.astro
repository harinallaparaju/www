---
import Layout from "../components/Layout.astro";
import { getCollection } from "astro:content";

const posts = await getCollection("blog");
const sortedPosts = posts.sort(
  (a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
);

// Get unique tags
const allTags = [
  ...new Set(posts.flatMap((p) => p.data.tags || []))
].sort();
---

<Layout>
  <main class="w-[90vw] xs:w-[500px] max-w-4xl mx-auto">
    <header class="mb-12">
      <h1 class="text-2xl font-medium mb-2">Writing</h1>
      <p class="text-neutral-500 font-light leading-relaxed">
        Thoughts, explorations, and learnings in systems, design, and life.
      </p>
    </header>

    <!-- Tag Filter -->
    {allTags.length > 0 && (
      <nav class="mb-10">
        <div class="flex flex-wrap gap-2">
          <a 
            href="/blog" 
            class="filter-tag filter-tag-active"
          >
            All
          </a>
          {allTags.map((tag) => (
            <a 
              href={"/blog/tag/" + tag.toLowerCase()} 
              class="filter-tag"
            >
              {tag}
            </a>
          ))}
        </div>
      </nav>
    )}

    <!-- Posts List -->
    <section class="space-y-8">
      {sortedPosts.length > 0 ? (
        sortedPosts.map((post, i) => (
          <article
            class="group opacity-0 animate-intro border-b border-neutral-100 pb-8 last:border-0"
            style={"animation-delay: " + (0.05 * i) + "s"}
          >
            <a
              href={"/blog/" + post.slug + "/"}
              class="block"
            >
              <h2 class="text-xl font-medium text-neutral-900 mb-2 group-hover:text-yellow-600 transition-colors">
                {post.data.title}
              </h2>
              
              {post.data.description && (
                <p class="text-neutral-600 font-light leading-relaxed mb-3">
                  {post.data.description}
                </p>
              )}

              <div class="flex items-center gap-3 text-sm text-neutral-400">
                <time datetime={new Date(post.data.pubDate).toISOString()}>
                  {new Date(post.data.pubDate).toLocaleDateString("en-US", {
                    month: "short",
                    day: "numeric",
                    year: "numeric"
                  })}
                </time>
                
                {post.data.tags && post.data.tags.length > 0 && (
                  <>
                    <span>Â·</span>
                    <div class="flex gap-2">
                      {post.data.tags.map((tag) => (
                        <span class="post-tag">{tag}</span>
                      ))}
                    </div>
                  </>
                )}
              </div>
            </a>
          </article>
        ))
      ) : (
        <p class="text-neutral-400 text-center py-12">No posts yet.</p>
      )}
    </section>
  </main>
</Layout>

<style>
  .filter-tag {
    display: inline-flex;
    align-items: center;
    padding: 0.375rem 0.875rem;
    border-radius: 999px;
    font-size: 0.875rem;
    font-weight: 400;
    background: rgba(0, 0, 0, 0.04);
    color: #737373;
    border: 1px solid transparent;
    transition: all 0.2s;
  }

  .filter-tag:hover {
    background: rgba(0, 0, 0, 0.06);
    color: #525252;
  }

  .filter-tag-active {
    background: #fbbf24;
    color: #78350f;
    font-weight: 500;
  }

  .filter-tag-active:hover {
    background: #f59e0b;
  }

  .post-tag {
    font-size: 0.75rem;
    color: #a3a3a3;
  }
</style>