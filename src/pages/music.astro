---
import Layout from "../components/Layout.astro";
import music from "../data/music.json";

// Group by genre if you want
const genres = [...new Set(music.map(m => m.genre))];
---

<Layout>
  <main class="w-[90vw] xs:w-[500px] max-w-4xl mx-auto">
    <header class="mb-12">
      <h1 class="text-2xl font-medium mb-2">Music I Like</h1>
      <p class="text-neutral-500 font-light leading-relaxed">
        Albums and artists that have been on repeat lately.
      </p>
    </header>

    <!-- Filter by genre (optional) -->
    {genres.length > 1 && (
      <nav class="mb-10">
        <div class="flex flex-wrap gap-2">
          <button 
            class="filter-tag filter-tag-active" 
            data-genre="all"
          >
            All
          </button>
          {genres.map((genre) => (
            <button 
              class="filter-tag" 
              data-genre={genre.toLowerCase()}
            >
              {genre}
            </button>
          ))}
        </div>
      </nav>
    )}

    <!-- Music Grid -->
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4" id="music-grid">
      {music.map((album) => (
        <a 
          href={album.spotify}
          target="_blank"
          rel="noopener noreferrer"
          class="music-card group relative aspect-square rounded-xl overflow-hidden shadow-sm hover:shadow-lg transition-all duration-300"
          data-genre={album.genre.toLowerCase()}
        >
          <img 
            src={album.cover} 
            alt={`${album.title} by ${album.artist}`}
            class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
            loading="lazy"
          />
          
          <!-- Hover overlay -->
          <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col justify-end p-4">
            <div class="text-white text-sm font-semibold leading-tight mb-1 line-clamp-2">
              {album.title}
            </div>
            <div class="text-white/80 text-xs line-clamp-1 mb-2">
              {album.artist}
            </div>
            <div class="text-[10px] text-white/60 uppercase tracking-wider">
              {album.genre}
            </div>
          </div>

          <!-- Play button -->
          <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
            <div class="w-12 h-12 rounded-full bg-green-500 flex items-center justify-center shadow-xl transform group-hover:scale-110 transition-transform">
              <svg width="18" height="18" fill="white" viewBox="0 0 24 24">
                <path d="M8 5v14l11-7z"/>
              </svg>
            </div>
          </div>
        </a>
      ))}
    </div>
  </main>
</Layout>

<style>
  .filter-tag {
    display: inline-flex;
    align-items: center;
    padding: 0.375rem 0.875rem;
    border-radius: 999px;
    font-size: 0.875rem;
    font-weight: 400;
    background: rgba(0, 0, 0, 0.04);
    color: #737373;
    border: 1px solid transparent;
    transition: all 0.2s;
    cursor: pointer;
  }

  .filter-tag:hover {
    background: rgba(0, 0, 0, 0.06);
    color: #525252;
  }

  .filter-tag-active {
    background: #10b981;
    color: white;
    font-weight: 500;
  }

  .filter-tag-active:hover {
    background: #059669;
  }

  .music-card {
    cursor: pointer;
    will-change: transform;
  }

  .music-card:hover {
    transform: translateY(-4px);
  }

  .music-card.hidden {
    display: none;
  }

  .line-clamp-1 {
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>

<script>
  // Genre filtering
  const filterButtons = document.querySelectorAll('.filter-tag');
  const musicCards = document.querySelectorAll('.music-card');

  filterButtons.forEach(button => {
    button.addEventListener('click', () => {
      const genre = button.getAttribute('data-genre');
      
      // Update active state
      filterButtons.forEach(btn => btn.classList.remove('filter-tag-active'));
      button.classList.add('filter-tag-active');

      // Filter cards
      musicCards.forEach(card => {
        const cardGenre = card.getAttribute('data-genre');
        
        if (genre === 'all' || cardGenre === genre) {
          card.classList.remove('hidden');
          card.style.animation = 'fadeIn 0.3s ease';
        } else {
          card.classList.add('hidden');
        }
      });
    });
  });
</script>

<style>
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }
</style>