---
import Layout from "../components/Layout.astro";
import { getCollection } from 'astro:content';

// Get all paper posts from content collection
const paperPosts = await getCollection('papers');

// Sort by date, newest first
const sortedPapers = paperPosts.sort((a, b) => 
  new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
);
---

<Layout>
  <main class="w-[90vw] xs:w-[500px] max-w-4xl mx-auto">
    <h1 class="text-2xl font-medium mb-2">Papershelf</h1>
    <p class="text-neutral-500 font-light mb-8">
      Dissections, insights, and ideas from research papers and engineering blogs.
    </p>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
      {sortedPapers.map((paper) => (
        <a
          href={"/papershelf/" + paper.slug + "/"}
          class="group block rounded-2xl border border-neutral-200 bg-white p-5 transition-all hover:shadow-md hover:-translate-y-[3px] hover:border-purple-200 hover:bg-gradient-to-br hover:from-white hover:to-purple-50/40"
        >
          <div class="flex justify-between items-start mb-2">
            <h2 class="font-medium text-lg leading-snug text-neutral-800 group-hover:text-purple-700 transition-colors flex-1 pr-2">
              {paper.data.title}
            </h2>
            
            <span
              class:list={[
                'tag-pill text-xs flex-shrink-0',
                paper.data.type === 'Paper Dissection'
                  ? 'tag-research'
                  : paper.data.type === 'Engineering'
                  ? 'tag-engineering'
                  : paper.data.type === 'Notes'
                  ? 'tag-notes'
                  : 'tag-default'
              ]}
            >
              {paper.data.year}
            </span>
          </div>

          <p class="text-sm font-light text-neutral-500 mb-3 line-clamp-2">
            {paper.data.summary}
          </p>

          <div class="flex items-center justify-between text-xs text-neutral-500">
            <span class="truncate">{paper.data.source}</span>
            <div class="flex items-center gap-1 group-hover:text-purple-700 transition-colors flex-shrink-0 ml-2">
              <span class="capitalize">{paper.data.type}</span>
            </div>
          </div>

          {paper.data.tags && paper.data.tags.length > 0 && (
            <div class="flex flex-wrap gap-1.5 mt-3">
              {paper.data.tags.slice(0, 3).map((tag: string) => (
                <span class="text-[10px] px-2 py-0.5 rounded-full bg-neutral-100 text-neutral-600">
                  {tag}
                </span>
              ))}
              {paper.data.tags.length > 3 && (
                <span class="text-[10px] px-2 py-0.5 text-neutral-400">
                  +{paper.data.tags.length - 3}
                </span>
              )}
            </div>
          )}
        </a>
      ))}
    </div>
  </main>
</Layout>

<style is:global>
  .tag-pill {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.25rem 0.6rem;
    border-radius: 9999px;
    font-weight: 500;
    letter-spacing: -0.01em;
    border: 1px solid transparent;
    transition: all 0.25s ease;
  }

  .tag-research {
    background: rgba(147, 51, 234, 0.1);
    color: #6d28d9;
    border-color: rgba(147, 51, 234, 0.15);
  }

  .tag-engineering {
    background: rgba(37, 99, 235, 0.1);
    color: #2563eb;
    border-color: rgba(37, 99, 235, 0.15);
  }

  .tag-notes {
    background: rgba(234, 179, 8, 0.1);
    color: #ca8a04;
    border-color: rgba(234, 179, 8, 0.15);
  }

  .tag-default {
    background: rgba(107, 114, 128, 0.1);
    color: #6b7280;
    border-color: rgba(107, 114, 128, 0.15);
  }

  .group:hover .tag-research {
    background: rgba(147, 51, 234, 0.15);
    box-shadow: 0 0 10px rgba(147, 51, 234, 0.15);
  }

  .group:hover .tag-engineering {
    background: rgba(37, 99, 235, 0.15);
    box-shadow: 0 0 10px rgba(37, 99, 235, 0.15);
  }

  .group:hover .tag-notes {
    background: rgba(234, 179, 8, 0.15);
    box-shadow: 0 0 10px rgba(234, 179, 8, 0.15);
  }

  .group:hover .tag-default {
    background: rgba(107, 114, 128, 0.15);
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>